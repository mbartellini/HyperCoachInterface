'use strict';const _0x2152cf=_0x1a36;(function(_0x10df4e,_0x56b05d){const _0x336d71=_0x1a36,_0x145a0e=_0x10df4e();while(!![]){try{const _0x30f534=-parseInt(_0x336d71(0xa1))/0x1*(-parseInt(_0x336d71(0xab))/0x2)+-parseInt(_0x336d71(0x8d))/0x3*(parseInt(_0x336d71(0xa7))/0x4)+-parseInt(_0x336d71(0x93))/0x5*(parseInt(_0x336d71(0x9e))/0x6)+-parseInt(_0x336d71(0x9b))/0x7+parseInt(_0x336d71(0x8b))/0x8+-parseInt(_0x336d71(0xa5))/0x9*(-parseInt(_0x336d71(0x96))/0xa)+parseInt(_0x336d71(0x98))/0xb;if(_0x30f534===_0x56b05d)break;else _0x145a0e['push'](_0x145a0e['shift']());}catch(_0x9cfe29){_0x145a0e['push'](_0x145a0e['shift']());}}}(_0x3824,0xe9319));const {RepositoryName,RepositoryFactory}=require(_0x2152cf(0x8a)),{ModelMapper}=require(_0x2152cf(0xa9)),{PagedResult}=require(_0x2152cf(0x83)),{NotFoundError,ForbiddenError}=require('../errors/errors');async function ensureRoutine(_0x13218b,_0x1443e9,_0x5de8a4=!![]){const _0x147496=_0x2152cf,_0xf0ad4f=RepositoryFactory[_0x147496(0x9f)](RepositoryName[_0x147496(0x97)]);let _0x53567b=await _0xf0ad4f[_0x147496(0x95)](_0x1443e9);if(!_0x53567b)throw new NotFoundError([_0x147496(0x85)+_0x1443e9+_0x147496(0xa6)]);if(_0x5de8a4&&_0x53567b[_0x147496(0x87)]!==_0x13218b['id'])throw new ForbiddenError([_0x147496(0xaa)+_0x1443e9]);return _0x53567b;}async function ensureCategory(_0x18fb2e){const _0x5de918=_0x2152cf,_0x135715=RepositoryFactory[_0x5de918(0x9f)](RepositoryName[_0x5de918(0x9a)]);let _0x2d671c=await _0x135715[_0x5de918(0x95)](_0x18fb2e);if(!_0x2d671c)throw new NotFoundError([_0x5de918(0x9d)+_0x18fb2e+_0x5de918(0xa6)]);return _0x2d671c;}function _0x3824(){const _0x18376b=['Routine\x20id\x20','User','userId','sportId','insert','../repository/RepositoryFactory','5742168ZiqvmX','deleteByFilter','3KiVeiS','mapRoutineDto','name','deleteById','removeSport','User\x20id\x20','8567470eecOFx','retrieveSportList','queryById','2270XNQLiO','Routine','18268404CKbsLU','mapPublicUserEntity','Category','12991496WveItw','categoryId','Category\x20id\x20','6ttLZNz','create','Sport','1296593KHsRkx','category','content','retrieveUserList','70362HGntNn','\x20not\x20found','3700924wOFYYQ','Sport\x20id\x20','./ModelMapper','User\x20is\x20not\x20the\x20owner\x20of\x20routine\x20id\x20','2dBToFJ','difficulty','all','queryByAdvancedFilter2','RoutineSport','exports','../utils/PagedResult','map'];_0x3824=function(){return _0x18376b;};return _0x3824();}async function ensureUser(_0x3ddebb){const _0x5e7232=_0x2152cf,_0x33dc62=RepositoryFactory[_0x5e7232(0x9f)](RepositoryName[_0x5e7232(0x86)]);let _0x2975d2=await _0x33dc62[_0x5e7232(0x95)](_0x3ddebb);if(!_0x2975d2)throw new NotFoundError([_0x5e7232(0x92)+_0x3ddebb+'\x20not\x20found']);return _0x2975d2;}async function ensureSport(_0x2565ef){const _0x4bf641=_0x2152cf,_0x1947ee=RepositoryFactory['create'](RepositoryName['Sport']);let _0x68ba25=await _0x1947ee[_0x4bf641(0x95)](_0x2565ef);if(!_0x68ba25)throw new NotFoundError([_0x4bf641(0xa8)+_0x2565ef+_0x4bf641(0xa6)]);return _0x68ba25;}function _0x1a36(_0x18aa1b,_0x2c09d8){const _0x382478=_0x3824();return _0x1a36=function(_0x1a3675,_0x2678c4){_0x1a3675=_0x1a3675-0x81;let _0x14d12d=_0x382478[_0x1a3675];return _0x14d12d;},_0x1a36(_0x18aa1b,_0x2c09d8);}async function deepMapRoutine(_0x1a70c7,_0x192d44,_0x3f8b72,_0x345f48=!![]){const _0x5c1b11=_0x2152cf;!_0x192d44&&_0x1a70c7['categoryId']&&(_0x192d44=await ensureCategory(_0x1a70c7[_0x5c1b11(0x9c)]));if(!_0x3f8b72&&_0x345f48){const _0x43e1e4=RepositoryFactory['create'](RepositoryName[_0x5c1b11(0x86)]);_0x3f8b72=await _0x43e1e4[_0x5c1b11(0x95)](_0x1a70c7[_0x5c1b11(0x87)]);if(!_0x3f8b72)throw new NotFoundError([_0x5c1b11(0x92)+_0x1a70c7[_0x5c1b11(0x87)]+_0x5c1b11(0xa6)]);}return ModelMapper['mapRoutineEntity'](_0x1a70c7,_0x345f48?ModelMapper[_0x5c1b11(0x99)](_0x3f8b72):undefined,_0x192d44?ModelMapper['mapCategoryEntity'](_0x192d44):undefined);}async function deepMapRoutineSport(_0x3c1b71){const _0x4dced6=_0x2152cf,_0x3b6321=RepositoryFactory[_0x4dced6(0x9f)](RepositoryName[_0x4dced6(0xa0)]),_0x1fef9c=await _0x3b6321[_0x4dced6(0x95)](_0x3c1b71[_0x4dced6(0x88)]);return ModelMapper['mapSportEntity'](_0x1fef9c);}module[_0x2152cf(0x82)]['add']=async(_0x1edaae,_0x3c75b7)=>{const _0x213ceb=_0x2152cf;let _0x5aa575;_0x3c75b7[_0x213ceb(0xa2)]&&(_0x5aa575=await ensureCategory(_0x3c75b7[_0x213ceb(0xa2)]['id']));const _0xd74b92=ModelMapper[_0x213ceb(0x8e)](_0x3c75b7,_0x1edaae['id']),_0x519c5c=RepositoryFactory[_0x213ceb(0x9f)](RepositoryName[_0x213ceb(0x97)]),_0x50061d=await _0x519c5c[_0x213ceb(0x89)](_0xd74b92);return await deepMapRoutine(_0x50061d,_0x5aa575,_0x1edaae,![]);},module[_0x2152cf(0x82)]['modify']=async(_0x22144a,_0x6f8d83,_0x49cab5)=>{const _0x136c2a=_0x2152cf;let _0x2531b4=await ensureRoutine(_0x22144a,_0x6f8d83),_0x365578;_0x49cab5[_0x136c2a(0xa2)]&&_0x2531b4[_0x136c2a(0x9c)]!==_0x49cab5['category']['id']&&(_0x365578=ensureCategory(_0x49cab5[_0x136c2a(0xa2)]['id']));ModelMapper['updateRoutineDto'](_0x2531b4,_0x49cab5);const _0x27e4ab=RepositoryFactory[_0x136c2a(0x9f)](RepositoryName[_0x136c2a(0x97)]);return await _0x27e4ab['update'](_0x2531b4),await deepMapRoutine(_0x2531b4,_0x365578,_0x22144a,![]);},module[_0x2152cf(0x82)]['remove']=async(_0x2755ae,_0x10e75a)=>{const _0x520149=_0x2152cf;await ensureRoutine(_0x2755ae,_0x10e75a);const _0x4df9bb=RepositoryFactory[_0x520149(0x9f)](RepositoryName[_0x520149(0x97)]);await _0x4df9bb[_0x520149(0x90)](_0x10e75a);},module[_0x2152cf(0x82)]['retrieve']=async(_0x5681cb,_0x4d813a)=>{const _0x58869b=_0x2152cf,_0x531243=await ensureRoutine(_0x5681cb,_0x4d813a,![]);if(!_0x531243['isPublic']&&_0x531243[_0x58869b(0x87)]!==_0x5681cb['id'])throw new ForbiddenError(['User\x20is\x20not\x20the\x20owner\x20of\x20routine\x20id\x20'+_0x4d813a]);return await deepMapRoutine(_0x531243);},module[_0x2152cf(0x82)]['retrieveList']=async(_0x106d4c,_0x1a3c56,_0x173bd2,_0x35b430,_0x337b32,_0x2aff11,_0x3dfb7a,_0x696196,_0x4fa22f)=>{const _0x50692f=_0x2152cf;let _0x481d5c={'isPublic':!![]};_0x106d4c&&(await ensureCategory(_0x106d4c),_0x481d5c[_0x50692f(0x9c)]=_0x106d4c);_0x1a3c56&&(await ensureUser(_0x1a3c56),_0x481d5c['userId']=_0x1a3c56);if(_0x173bd2)_0x481d5c[_0x50692f(0xac)]=_0x173bd2;if(_0x35b430)_0x481d5c['score']=_0x35b430;const _0x1afa10=_0x337b32?{'column':_0x50692f(0x8f),'value':_0x337b32}:null,_0x31c4f9=RepositoryFactory['create'](RepositoryName[_0x50692f(0x97)]);let _0x44e353=await _0x31c4f9[_0x50692f(0xae)](_0x481d5c,_0x1afa10,_0x2aff11,_0x3dfb7a,_0x696196,_0x4fa22f);return _0x44e353[_0x50692f(0xa3)]=await Promise[_0x50692f(0xad)](_0x44e353[_0x50692f(0xa3)]['map'](async _0x402259=>{return await deepMapRoutine(_0x402259);})),_0x44e353;},module[_0x2152cf(0x82)][_0x2152cf(0xa4)]=async(_0x1162a7,_0x135319,_0x5c7536,_0x267b86,_0x72f37,_0x420ea5,_0x12bebf,_0x2fc924)=>{const _0x43fa71=_0x2152cf;let _0x27a6e4={'userId':_0x135319};_0x1162a7['id']!==_0x135319&&(await ensureUser(_0x135319),_0x27a6e4['isPublic']=!![]);if(_0x5c7536)_0x27a6e4[_0x43fa71(0xac)]=_0x5c7536;const _0x1703ff=_0x267b86?{'column':'name','value':_0x267b86}:null,_0x4a7be3=RepositoryFactory[_0x43fa71(0x9f)](RepositoryName['Routine']);let _0x178342=await _0x4a7be3['queryByAdvancedFilter'](_0x27a6e4,_0x1703ff,_0x72f37,_0x420ea5,_0x12bebf,_0x2fc924);return _0x178342['content']=await Promise[_0x43fa71(0xad)](_0x178342['content'][_0x43fa71(0x84)](async _0x153495=>{return await deepMapRoutine(_0x153495,undefined,undefined,![]);})),_0x178342;},module[_0x2152cf(0x82)]['addSport']=async(_0x29e520,_0x2b0351,_0x4f1265)=>{const _0x57f6a4=_0x2152cf;await ensureRoutine(_0x29e520,_0x2b0351),await ensureSport(_0x4f1265);const _0x422177=RepositoryFactory[_0x57f6a4(0x9f)](RepositoryName['RoutineSport']);await _0x422177[_0x57f6a4(0x89)]({'routineId':_0x2b0351,'sportId':_0x4f1265});},module[_0x2152cf(0x82)][_0x2152cf(0x91)]=async(_0x9d02a0,_0x3f4218,_0x47637e)=>{const _0x4000e5=_0x2152cf;await ensureRoutine(_0x9d02a0,_0x3f4218),await ensureSport(_0x47637e);const _0x3ab123=RepositoryFactory[_0x4000e5(0x9f)](RepositoryName[_0x4000e5(0x81)]);await _0x3ab123[_0x4000e5(0x8c)]({'routineId':_0x3f4218,'sportId':_0x47637e});},module['exports'][_0x2152cf(0x94)]=async(_0x2b28d8,_0x178a52,_0x2ce100,_0xe8d854,_0x586fb0,_0x2cf7c0)=>{const _0x17c014=_0x2152cf;await ensureRoutine(_0x2b28d8,_0x178a52);const _0xe9d414={'routineId':_0x178a52},_0x25be2e=RepositoryFactory[_0x17c014(0x9f)](RepositoryName[_0x17c014(0x81)]);let _0x235485=await _0x25be2e['queryByAdvancedFilter'](_0xe9d414,null,_0x2ce100,_0xe8d854,_0x586fb0,_0x2cf7c0);return _0x235485[_0x17c014(0xa3)]=await Promise['all'](_0x235485['content']['map'](async _0xf6f7b=>{return await deepMapRoutineSport(_0xf6f7b);})),_0x235485;};